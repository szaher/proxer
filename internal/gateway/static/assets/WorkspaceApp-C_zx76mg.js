import{r as s,j as e}from"./index-LUL3eYLK.js";const A={dashboard:{title:"Tenant Dashboard",subtitle:"Plan gauges, statuses, and usage."},routes:{title:"Route Management",subtitle:"Create and manage route forwarding rules."},connectors:{title:"Connector Management",subtitle:"Pair hosts and monitor connector status."},tenantConfig:{title:"Tenant Configuration",subtitle:"Manage environment defaults for local targets."},adminOverview:{title:"Super Admin Overview",subtitle:"Global counts, usage and platform snapshot."},adminUsers:{title:"User Administration",subtitle:"Create and update users across all tenants."},adminTenants:{title:"Tenant Administration",subtitle:"Create tenants and assign subscription plans."},adminPlans:{title:"Plan Management",subtitle:"Control quotas and traffic caps for all plans."},adminTLS:{title:"TLS Certificates",subtitle:"Upload, activate, and remove TLS certificates."},adminSystem:{title:"System Status",subtitle:"Health, incidents, queues, and runtime status."}},q=[{key:"adminOverview",label:"Overview"},{key:"adminUsers",label:"Users"},{key:"adminTenants",label:"Tenants"},{key:"adminPlans",label:"Plans"},{key:"adminTLS",label:"TLS"},{key:"adminSystem",label:"System"},{key:"routes",label:"Routes"},{key:"connectors",label:"Connectors"},{key:"tenantConfig",label:"Tenant Config"}],M=[{key:"dashboard",label:"Dashboard"},{key:"routes",label:"Routes"},{key:"connectors",label:"Connectors"},{key:"tenantConfig",label:"Tenant Config"}];function $(n){return typeof n=="object"&&n!==null}function v(n){return n instanceof Error?n.message:typeof n=="string"?n:"Request failed"}function F(n){return!Number.isFinite(n)||n<0?0:n>1?1:n}function L(n){const t=Number(n??0);return Number.isFinite(t)?`${Math.round(t*100)}%`:"0%"}function E(n){const t=Number(n??0);return Number.isFinite(t)?Math.abs(t)>=100?`${Math.round(t)}`:t.toFixed(2).replace(/\.00$/,""):"0"}function U(n){if(!n)return"-";const t=new Date(n);return Number.isNaN(t.getTime())?n:t.toLocaleString()}function I(n){const t=n.toLowerCase();return["online","active","enabled","ok"].includes(t)?"ok":["offline","degraded","disabled","critical","error"].includes(t)?"fail":"warn"}function w({value:n}){return e.jsx("span",{className:`badge ${I(n)}`,children:n})}function R({title:n,gauge:t,subtitle:y}){const h=Number((t==null?void 0:t.used)??0),_=Number((t==null?void 0:t.limit)??0),i=Math.round(F(Number((t==null?void 0:t.percent)??0))*100),f={background:`conic-gradient(var(--ring-fill) ${i}%, var(--ring-bg) ${i}% 100%)`};return e.jsxs("article",{className:"gauge-card",children:[e.jsx("h3",{children:n}),e.jsx("div",{className:"gauge-ring",style:f,children:e.jsxs("span",{children:[E(h)," / ",E(_)]})}),e.jsx("p",{children:y})]})}function C({title:n,children:t,actions:y}){return e.jsxs("section",{className:"panel",children:[e.jsxs("header",{className:"panel-head",children:[e.jsx("h3",{children:n}),y?e.jsx("div",{className:"panel-actions",children:y}):null]}),t]})}function J({api:n}){var g,d,S,c,r,o,b;const[t,y]=s.useState(null),[h,_]=s.useState(!0),[i,f]=s.useState(""),x=s.useCallback(async()=>{_(!0),f("");try{const m=await n("/api/me/dashboard");y(m)}catch(m){f(v(m))}finally{_(!1)}},[n]);if(s.useEffect(()=>{x()},[x]),h)return e.jsx(C,{title:"Dashboard",children:"Loading..."});if(i)return e.jsx(C,{title:"Dashboard",actions:e.jsx("button",{onClick:()=>void x(),children:"Retry"}),children:e.jsx("p",{className:"status error",children:i})});const j=(t==null?void 0:t.routes)??[],u=(t==null?void 0:t.connectors)??[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"gauge-row",children:[e.jsx(R,{title:"Routes",gauge:(g=t==null?void 0:t.gauges)==null?void 0:g.routes,subtitle:"Used / plan limit"}),e.jsx(R,{title:"Connectors",gauge:(d=t==null?void 0:t.gauges)==null?void 0:d.connectors,subtitle:"Used / plan limit"}),e.jsx(R,{title:"Traffic (GB)",gauge:(S=t==null?void 0:t.gauges)==null?void 0:S.traffic,subtitle:"Monthly used / cap"})]}),e.jsx(C,{title:"Live Status",actions:e.jsx("button",{onClick:()=>void x(),children:"Refresh"}),children:e.jsxs("div",{className:"kv",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Plan"}),e.jsx("span",{children:((c=t==null?void 0:t.plan)==null?void 0:c.id)??"free"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Blocked Requests"}),e.jsx("span",{children:((r=t==null?void 0:t.status)==null?void 0:r.blocked_requests_month)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Routes Active"}),e.jsx("span",{children:((o=t==null?void 0:t.status)==null?void 0:o.routes_active)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Connectors Online"}),e.jsx("span",{children:((b=t==null?void 0:t.status)==null?void 0:b.connectors_online)??0})]})]})}),e.jsx(C,{title:"Routes",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tenant"}),e.jsx("th",{children:"Route"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Public URL"})]})}),e.jsx("tbody",{children:j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"No routes yet."})}):j.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.tenant_id}),e.jsx("td",{children:m.id}),e.jsx("td",{children:e.jsx(w,{value:m.connected?"active":"degraded"})}),e.jsx("td",{className:"code",children:m.public_url??"-"})]},`${m.tenant_id}:${m.id}`))})]})}),e.jsx(C,{title:"Connectors",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Agent"}),e.jsx("th",{children:"Last Seen"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"No connectors yet."})}):u.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:m.id}),e.jsx("td",{children:e.jsx(w,{value:m.connected?"online":"offline"})}),e.jsx("td",{children:m.agent_id??"-"}),e.jsx("td",{children:U(m.last_seen)})]},m.id))})]})})]})}function V({api:n}){var r,o,b,m,N,k,a;const[t,y]=s.useState(null),[h,_]=s.useState(null),[i,f]=s.useState(!0),[x,j]=s.useState(""),u=s.useCallback(async()=>{f(!0),j("");try{const[l,p]=await Promise.all([n("/api/admin/stats"),n("/api/admin/system-status")]);y(l),_(p)}catch(l){j(v(l))}finally{f(!1)}},[n]);if(s.useEffect(()=>{u()},[u]),i)return e.jsx(C,{title:"Overview",children:"Loading..."});if(x)return e.jsx(C,{title:"Overview",actions:e.jsx("button",{onClick:()=>void u(),children:"Retry"}),children:e.jsx("p",{className:"status error",children:x})});const g=Number((t==null?void 0:t.route_count)??0),d=Number((t==null?void 0:t.connector_count)??0),S=Number((t==null?void 0:t.tenant_count)??0),c=((r=t==null?void 0:t.funnel_analytics)==null?void 0:r.totals)??{};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"gauge-row",children:[e.jsx(R,{title:"Routes",gauge:{used:g,limit:Math.max(g,1),percent:1},subtitle:"Global route count"}),e.jsx(R,{title:"Connectors",gauge:{used:d,limit:Math.max(d,1),percent:1},subtitle:"Global connector count"}),e.jsx(R,{title:"Tenants",gauge:{used:S,limit:Math.max(S,1),percent:1},subtitle:"Global tenant count"})]}),e.jsx(C,{title:"Global Snapshot",actions:e.jsx("button",{onClick:()=>void u(),children:"Refresh"}),children:e.jsxs("div",{className:"kv",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Users"}),e.jsx("span",{children:(t==null?void 0:t.user_count)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Active Connectors"}),e.jsx("span",{children:(t==null?void 0:t.active_connectors)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Storage Driver"}),e.jsx("span",{children:(t==null?void 0:t.storage_driver)??"memory"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Uptime (s)"}),e.jsx("span",{children:(t==null?void 0:t.uptime_seconds)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Signup Success"}),e.jsx("span",{children:c.signup_success??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Download Clicks"}),e.jsx("span",{children:c.download_click??0})]})]})}),e.jsx(C,{title:"Runtime",children:e.jsxs("div",{className:"kv",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Pending Requests"}),e.jsxs("span",{children:[((o=h==null?void 0:h.runtime)==null?void 0:o.pending_requests)??0," / ",((b=h==null?void 0:h.runtime)==null?void 0:b.max_pending_global)??0]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Queue Depth"}),e.jsx("span",{children:((m=h==null?void 0:h.runtime)==null?void 0:m.queue_depth_total)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Latency p50 / p95"}),e.jsxs("span",{children:[((N=h==null?void 0:h.runtime)==null?void 0:N.p50_latency_ms)??0,"ms / ",((k=h==null?void 0:h.runtime)==null?void 0:k.p95_latency_ms)??0,"ms"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error Rate"}),e.jsx("span",{children:L((a=h==null?void 0:h.runtime)==null?void 0:a.error_rate)})]})]})})]})}function G({api:n}){const[t,y]=s.useState([]),[h,_]=s.useState([]),[i,f]=s.useState(!0),[x,j]=s.useState(""),[u,g]=s.useState(""),d=s.useCallback(async()=>{f(!0),j("");try{const[r,o]=await Promise.all([n("/api/admin/users"),n("/api/tenants")]);y(r.users??[]),_(o.tenants??[])}catch(r){j(v(r))}finally{f(!1)}},[n]);s.useEffect(()=>{d()},[d]);const S=s.useCallback(async r=>{r.preventDefault(),g("");const o=r.currentTarget,b=new FormData(o);try{await n("/api/admin/users",{method:"POST",body:JSON.stringify({username:String(b.get("username")??""),password:String(b.get("password")??""),role:String(b.get("role")??"member"),tenant_id:String(b.get("tenant_id")??"")})}),o.reset(),g("User created."),await d()}catch(m){g(v(m))}},[n,d]),c=s.useCallback(async r=>{g("");try{await n(`/api/admin/users/${encodeURIComponent(r.username)}`,{method:"PATCH",body:JSON.stringify({status:r.status==="disabled"?"active":"disabled"})}),await d()}catch(o){g(v(o))}},[n,d]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Create User",children:[e.jsxs("form",{className:"inline-form",onSubmit:S,children:[e.jsx("input",{name:"username",placeholder:"username",required:!0}),e.jsx("input",{name:"password",type:"password",placeholder:"password",required:!0}),e.jsxs("select",{name:"role",defaultValue:"member",children:[e.jsx("option",{value:"member",children:"member"}),e.jsx("option",{value:"tenant_admin",children:"tenant_admin"}),e.jsx("option",{value:"super_admin",children:"super_admin"})]}),e.jsxs("select",{name:"tenant_id",defaultValue:"",children:[e.jsx("option",{value:"",children:"No tenant (super admin)"}),h.map(r=>e.jsx("option",{value:r.id,children:r.id},r.id))]}),e.jsx("button",{type:"submit",children:"Create"})]}),u?e.jsx("p",{className:"status",children:u}):null]}),e.jsxs(C,{title:"Users",actions:e.jsx("button",{onClick:()=>void d(),children:"Refresh"}),children:[i?e.jsx("p",{children:"Loading..."}):null,x?e.jsx("p",{className:"status error",children:x}):null,!i&&!x?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Tenant"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"No users."})}):t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{children:r.username}),e.jsx("td",{children:r.role}),e.jsx("td",{children:r.tenant_id||"-"}),e.jsx("td",{children:e.jsx(w,{value:r.status||"active"})}),e.jsx("td",{children:e.jsx("button",{className:"ghost",onClick:()=>void c(r),children:r.status==="disabled"?"Enable":"Disable"})})]},r.username))})]}):null]})]})}function B({api:n}){const[t,y]=s.useState([]),[h,_]=s.useState([]),[i,f]=s.useState(!0),[x,j]=s.useState(""),[u,g]=s.useState(""),d=s.useCallback(async()=>{f(!0),j("");try{const[r,o]=await Promise.all([n("/api/tenants"),n("/api/admin/plans")]);y(r.tenants??[]),_(o.plans??[])}catch(r){j(v(r))}finally{f(!1)}},[n]);s.useEffect(()=>{d()},[d]);const S=s.useCallback(async r=>{r.preventDefault(),g("");const o=r.currentTarget,b=new FormData(o);try{await n("/api/tenants",{method:"POST",body:JSON.stringify({id:String(b.get("id")??""),name:String(b.get("name")??"")})}),o.reset(),g("Tenant created."),await d()}catch(m){g(v(m))}},[n,d]),c=s.useCallback(async(r,o)=>{g("");try{await n(`/api/admin/tenants/${encodeURIComponent(r)}/assign-plan`,{method:"POST",body:JSON.stringify({plan_id:o})}),g(`Assigned plan ${o} to ${r}.`)}catch(b){g(v(b))}},[n]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Create Tenant",children:[e.jsxs("form",{className:"inline-form",onSubmit:S,children:[e.jsx("input",{name:"id",placeholder:"tenant-id",required:!0}),e.jsx("input",{name:"name",placeholder:"Tenant name",required:!0}),e.jsx("button",{type:"submit",children:"Create"})]}),u?e.jsx("p",{className:"status",children:u}):null]}),e.jsxs(C,{title:"Tenants",actions:e.jsx("button",{onClick:()=>void d(),children:"Refresh"}),children:[i?e.jsx("p",{children:"Loading..."}):null,x?e.jsx("p",{className:"status error",children:x}):null,!i&&!x?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Routes"}),e.jsx("th",{children:"Assign Plan"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"No tenants."})}):t.map(r=>{var o;return e.jsxs("tr",{children:[e.jsx("td",{children:r.id}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.route_count??0}),e.jsx("td",{children:e.jsxs("form",{className:"inline-form",onSubmit:b=>{b.preventDefault();const m=new FormData(b.currentTarget);c(r.id,String(m.get("plan_id")??""))},children:[e.jsx("select",{name:"plan_id",defaultValue:((o=h[0])==null?void 0:o.id)??"",children:h.map(b=>e.jsx("option",{value:b.id,children:b.id},b.id))}),e.jsx("button",{type:"submit",children:"Assign"})]})})]},r.id)})})]}):null]})]})}function H({api:n}){const[t,y]=s.useState([]),[h,_]=s.useState(!0),[i,f]=s.useState(""),[x,j]=s.useState(""),u=s.useCallback(async()=>{_(!0),f("");try{const d=await n("/api/admin/plans");y(d.plans??[])}catch(d){f(v(d))}finally{_(!1)}},[n]);s.useEffect(()=>{u()},[u]);const g=s.useCallback(async d=>{d.preventDefault(),j("");const S=d.currentTarget,c=new FormData(S);try{await n("/api/admin/plans",{method:"POST",body:JSON.stringify({id:String(c.get("id")??""),name:String(c.get("name")??""),description:String(c.get("description")??""),max_routes:Number(c.get("max_routes")??0),max_connectors:Number(c.get("max_connectors")??0),max_rps:Number(c.get("max_rps")??0),max_monthly_gb:Number(c.get("max_monthly_gb")??0),tls_enabled:c.get("tls_enabled")==="on",price_monthly_usd:Number(c.get("price_monthly_usd")??0),price_annual_usd:Number(c.get("price_annual_usd")??0),public_order:Number(c.get("public_order")??0)})}),S.reset(),j("Plan saved."),await u()}catch(r){j(v(r))}},[n,u]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Create Plan",children:[e.jsxs("form",{className:"inline-form",onSubmit:g,children:[e.jsx("input",{name:"id",placeholder:"id",required:!0}),e.jsx("input",{name:"name",placeholder:"name",required:!0}),e.jsx("input",{name:"description",placeholder:"description"}),e.jsx("input",{name:"max_routes",type:"number",min:1,placeholder:"max routes",required:!0}),e.jsx("input",{name:"max_connectors",type:"number",min:1,placeholder:"max connectors",required:!0}),e.jsx("input",{name:"max_rps",type:"number",min:1,placeholder:"max rps",required:!0}),e.jsx("input",{name:"max_monthly_gb",type:"number",min:1,placeholder:"max monthly gb",required:!0}),e.jsx("input",{name:"price_monthly_usd",type:"number",min:0,step:"0.01",placeholder:"monthly price",required:!0}),e.jsx("input",{name:"price_annual_usd",type:"number",min:0,step:"0.01",placeholder:"annual price",required:!0}),e.jsx("input",{name:"public_order",type:"number",min:0,placeholder:"public order",required:!0}),e.jsxs("label",{className:"checkbox",children:[e.jsx("input",{type:"checkbox",name:"tls_enabled"}),"TLS enabled"]}),e.jsx("button",{type:"submit",children:"Save"})]}),x?e.jsx("p",{className:"status",children:x}):null]}),e.jsxs(C,{title:"Plans",actions:e.jsx("button",{onClick:()=>void u(),children:"Refresh"}),children:[h?e.jsx("p",{children:"Loading..."}):null,i?e.jsx("p",{className:"status error",children:i}):null,!h&&!i?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Routes"}),e.jsx("th",{children:"Connectors"}),e.jsx("th",{children:"RPS"}),e.jsx("th",{children:"Monthly GB"}),e.jsx("th",{children:"Monthly USD"}),e.jsx("th",{children:"Annual USD"}),e.jsx("th",{children:"Order"}),e.jsx("th",{children:"TLS"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,children:"No plans."})}):t.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:d.id}),e.jsx("td",{children:d.name}),e.jsx("td",{children:d.max_routes}),e.jsx("td",{children:d.max_connectors}),e.jsx("td",{children:d.max_rps}),e.jsx("td",{children:d.max_monthly_gb}),e.jsx("td",{children:E(d.price_monthly_usd)}),e.jsx("td",{children:E(d.price_annual_usd)}),e.jsx("td",{children:d.public_order??0}),e.jsx("td",{children:e.jsx(w,{value:d.tls_enabled?"enabled":"disabled"})})]},d.id))})]}):null]})]})}function z({api:n}){const[t,y]=s.useState([]),[h,_]=s.useState(!0),[i,f]=s.useState(""),[x,j]=s.useState(""),u=s.useCallback(async()=>{_(!0),f("");try{const c=await n("/api/admin/tls/certificates");y(c.certificates??[])}catch(c){f(v(c))}finally{_(!1)}},[n]);s.useEffect(()=>{u()},[u]);const g=s.useCallback(async c=>{c.preventDefault(),j("");const r=c.currentTarget,o=new FormData(r);try{await n("/api/admin/tls/certificates",{method:"POST",body:JSON.stringify({id:String(o.get("id")??""),hostname:String(o.get("hostname")??""),cert_pem:String(o.get("cert_pem")??""),key_pem:String(o.get("key_pem")??""),active:o.get("active")==="on"})}),r.reset(),j("Certificate uploaded."),await u()}catch(b){j(v(b))}},[n,u]),d=s.useCallback(async(c,r)=>{j("");try{await n(`/api/admin/tls/certificates/${encodeURIComponent(c.id)}`,{method:"PATCH",body:JSON.stringify({active:r})}),await u()}catch(o){j(v(o))}},[n,u]),S=s.useCallback(async c=>{j("");try{await n(`/api/admin/tls/certificates/${encodeURIComponent(c.id)}`,{method:"DELETE"}),await u()}catch(r){j(v(r))}},[n,u]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Upload Certificate",children:[e.jsxs("form",{className:"stack",onSubmit:g,children:[e.jsxs("div",{className:"inline-form",children:[e.jsx("input",{name:"id",placeholder:"id",required:!0}),e.jsx("input",{name:"hostname",placeholder:"example.com",required:!0}),e.jsxs("label",{className:"checkbox",children:[e.jsx("input",{name:"active",type:"checkbox"}),"Active"]})]}),e.jsxs("label",{children:["Certificate PEM",e.jsx("textarea",{name:"cert_pem",rows:6,required:!0})]}),e.jsxs("label",{children:["Private Key PEM",e.jsx("textarea",{name:"key_pem",rows:6,required:!0})]}),e.jsx("button",{type:"submit",children:"Upload"})]}),x?e.jsx("p",{className:"status",children:x}):null]}),e.jsxs(C,{title:"Certificates",actions:e.jsx("button",{onClick:()=>void u(),children:"Refresh"}),children:[h?e.jsx("p",{children:"Loading..."}):null,i?e.jsx("p",{className:"status error",children:i}):null,!h&&!i?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Hostname"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Expires"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"No certificates."})}):t.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.id}),e.jsx("td",{children:c.hostname}),e.jsx("td",{children:e.jsx(w,{value:c.active?"active":"inactive"})}),e.jsx("td",{children:c.expires_at?c.expires_at.slice(0,10):"-"}),e.jsx("td",{children:e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"ghost",onClick:()=>void d(c,!c.active),children:c.active?"Deactivate":"Activate"}),e.jsx("button",{className:"ghost danger",onClick:()=>void S(c),children:"Delete"})]})})]},c.id))})]}):null]})]})}function K({api:n}){var g,d,S,c,r,o,b;const[t,y]=s.useState(null),[h,_]=s.useState([]),[i,f]=s.useState(!0),[x,j]=s.useState(""),u=s.useCallback(async()=>{f(!0),j("");try{const[m,N]=await Promise.all([n("/api/admin/system-status"),n("/api/admin/incidents?limit=100")]);y(m),_(N.incidents??[])}catch(m){j(v(m))}finally{f(!1)}},[n]);return s.useEffect(()=>{u()},[u]),e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"System Status",actions:e.jsx("button",{onClick:()=>void u(),children:"Refresh"}),children:[i?e.jsx("p",{children:"Loading..."}):null,x?e.jsx("p",{className:"status error",children:x}):null,!i&&!x?e.jsxs("div",{className:"kv",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Gateway"}),e.jsx("span",{children:((g=t==null?void 0:t.gateway)==null?void 0:g.status)??"unknown"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Storage"}),e.jsx("span",{children:((d=t==null?void 0:t.storage)==null?void 0:d.driver)??"memory"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Active Sessions"}),e.jsx("span",{children:((S=t==null?void 0:t.runtime)==null?void 0:S.active_sessions)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Pending Requests"}),e.jsx("span",{children:((c=t==null?void 0:t.runtime)==null?void 0:c.pending_requests)??0})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Latency p50/p95"}),e.jsxs("span",{children:[((r=t==null?void 0:t.runtime)==null?void 0:r.p50_latency_ms)??0,"ms / ",((o=t==null?void 0:t.runtime)==null?void 0:o.p95_latency_ms)??0,"ms"]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Error Rate"}),e.jsx("span",{children:L((b=t==null?void 0:t.runtime)==null?void 0:b.error_rate)})]})]}):null]}),e.jsx(C,{title:"Incidents",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Severity"}),e.jsx("th",{children:"Source"}),e.jsx("th",{children:"Message"}),e.jsx("th",{children:"Created"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:"No incidents."})}):h.map(m=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(w,{value:m.severity})}),e.jsx("td",{children:m.source}),e.jsx("td",{children:m.message}),e.jsx("td",{children:U(m.created_at)})]},m.id))})]})})]})}function Q({api:n,me:t}){var k;const y=t.user.role==="super_admin",[h,_]=s.useState([]),[i,f]=s.useState([]),[x,j]=s.useState([]),[u,g]=s.useState(!0),[d,S]=s.useState(""),[c,r]=s.useState(""),o=s.useCallback(async()=>{g(!0),S("");try{const[a,l,p]=await Promise.all([n("/api/me/routes"),n("/api/me/connectors"),n("/api/tenants")]);_(a.routes??[]),f(l.connectors??[]),j(p.tenants??[])}catch(a){S(v(a))}finally{g(!1)}},[n]);s.useEffect(()=>{o()},[o]);const b=s.useCallback(async a=>{var T;a.preventDefault(),r("");const l=a.currentTarget,p=new FormData(l),P=y?String(p.get("tenant_id")??""):t.user.tenant_id||((T=x[0])==null?void 0:T.id)||"default";try{await n(`/api/tenants/${encodeURIComponent(P)}/routes`,{method:"POST",body:JSON.stringify({id:String(p.get("id")??""),target:String(p.get("target")??""),token:String(p.get("token")??""),max_rps:Number(p.get("max_rps")??0),connector_id:String(p.get("connector_id")??""),local_scheme:String(p.get("local_scheme")??"http"),local_host:String(p.get("local_host")??"127.0.0.1"),local_port:Number(p.get("local_port")??0),local_base_path:String(p.get("local_base_path")??"")})}),r("Route saved."),l.reset(),await o()}catch(D){r(v(D))}},[n,y,o,t.user.tenant_id,x]),m=s.useCallback(async a=>{r("");try{await n(`/api/tenants/${encodeURIComponent(a.tenant_id)}/routes/${encodeURIComponent(a.id)}`,{method:"DELETE"}),await o()}catch(l){r(v(l))}},[n,o]),N=t.user.tenant_id||((k=x[0])==null?void 0:k.id)||"default";return e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Create Route",children:[e.jsxs("form",{className:"grid cols-2",onSubmit:b,children:[e.jsxs("label",{children:["Tenant",e.jsx("select",{name:"tenant_id",defaultValue:N,disabled:!y,required:y,children:x.map(a=>e.jsx("option",{value:a.id,children:a.id},a.id))})]}),e.jsxs("label",{children:["Route ID",e.jsx("input",{name:"id",placeholder:"api",required:!0})]}),e.jsxs("label",{children:["Direct Target URL",e.jsx("input",{name:"target",placeholder:"http://127.0.0.1:3000"})]}),e.jsxs("label",{children:["Connector",e.jsxs("select",{name:"connector_id",defaultValue:"",children:[e.jsx("option",{value:"",children:"Direct target"}),i.map(a=>e.jsx("option",{value:a.id,children:a.id},a.id))]})]}),e.jsxs("label",{children:["Local Scheme",e.jsxs("select",{name:"local_scheme",defaultValue:"http",children:[e.jsx("option",{value:"http",children:"http"}),e.jsx("option",{value:"https",children:"https"})]})]}),e.jsxs("label",{children:["Local Host",e.jsx("input",{name:"local_host",defaultValue:"127.0.0.1"})]}),e.jsxs("label",{children:["Local Port",e.jsx("input",{name:"local_port",type:"number",min:1,max:65535,placeholder:"3000"})]}),e.jsxs("label",{children:["Local Base Path",e.jsx("input",{name:"local_base_path",placeholder:"/"})]}),e.jsxs("label",{children:["Access Token",e.jsx("input",{name:"token",placeholder:"optional"})]}),e.jsxs("label",{children:["Route Max RPS",e.jsx("input",{name:"max_rps",type:"number",min:0,step:"0.1",placeholder:"0 = fair share"})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",children:"Save Route"})})]}),c?e.jsx("p",{className:"status",children:c}):null]}),e.jsxs(C,{title:"Routes",actions:e.jsx("button",{onClick:()=>void o(),children:"Refresh"}),children:[u?e.jsx("p",{children:"Loading..."}):null,d?e.jsx("p",{className:"status error",children:d}):null,!u&&!d?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tenant"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Connector"}),e.jsx("th",{children:"Max RPS"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Public URL"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:"No routes."})}):h.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.tenant_id}),e.jsx("td",{children:a.id}),e.jsx("td",{children:a.connector_id||"-"}),e.jsx("td",{children:a.max_rps&&a.max_rps>0?a.max_rps:"-"}),e.jsx("td",{children:e.jsx(w,{value:a.connected?"active":"offline"})}),e.jsx("td",{className:"code",children:a.public_url??"-"}),e.jsx("td",{children:e.jsx("button",{className:"ghost danger",onClick:()=>void m(a),children:"Delete"})})]},`${a.tenant_id}:${a.id}`))})]}):null]})]})}function W({api:n,me:t}){var a;const y=t.user.role==="super_admin",[h,_]=s.useState([]),[i,f]=s.useState([]),[x,j]=s.useState(!0),[u,g]=s.useState(""),[d,S]=s.useState(""),[c,r]=s.useState(""),o=s.useCallback(async()=>{j(!0),g("");try{const[l,p]=await Promise.all([n("/api/me/connectors"),n("/api/tenants")]);_(l.connectors??[]),f(p.tenants??[])}catch(l){g(v(l))}finally{j(!1)}},[n]);s.useEffect(()=>{o()},[o]);const b=s.useCallback(async l=>{var D;l.preventDefault(),S("");const p=l.currentTarget,P=new FormData(p),T=y?String(P.get("tenant_id")??""):t.user.tenant_id||((D=i[0])==null?void 0:D.id)||"default";try{await n("/api/connectors",{method:"POST",body:JSON.stringify({tenant_id:T,id:String(P.get("id")??""),name:String(P.get("name")??"")})}),p.reset(),S("Connector created."),await o()}catch(O){S(v(O))}},[n,y,o,t.user.tenant_id,i]),m=s.useCallback(async l=>{S("");try{const p=await n(`/api/connectors/${encodeURIComponent(l)}/pair`,{method:"POST"});r(p.command??"")}catch(p){S(v(p))}},[n]),N=s.useCallback(async l=>{S("");try{const p=await n(`/api/connectors/${encodeURIComponent(l)}/rotate`,{method:"POST"});r(`connector_secret=${p.connector_secret??""}`)}catch(p){S(v(p))}},[n]),k=s.useCallback(async l=>{S("");try{await n(`/api/connectors/${encodeURIComponent(l)}`,{method:"DELETE"}),await o()}catch(p){S(v(p))}},[n,o]);return e.jsxs(e.Fragment,{children:[e.jsxs(C,{title:"Create Connector",children:[e.jsxs("form",{className:"inline-form",onSubmit:b,children:[y?e.jsx("select",{name:"tenant_id",defaultValue:t.user.tenant_id||((a=i[0])==null?void 0:a.id)||"default",children:i.map(l=>e.jsx("option",{value:l.id,children:l.id},l.id))}):null,e.jsx("input",{name:"id",placeholder:"connector-id",required:!0}),e.jsx("input",{name:"name",placeholder:"Friendly name",required:!0}),e.jsx("button",{type:"submit",children:"Create"})]}),d?e.jsx("p",{className:"status",children:d}):null,c?e.jsx("p",{className:"code output",children:c}):null]}),e.jsxs(C,{title:"Connectors",actions:e.jsx("button",{onClick:()=>void o(),children:"Refresh"}),children:[x?e.jsx("p",{children:"Loading..."}):null,u?e.jsx("p",{className:"status error",children:u}):null,!x&&!u?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Tenant"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Agent"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"No connectors."})}):h.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:l.id}),e.jsx("td",{children:l.tenant_id}),e.jsx("td",{children:e.jsx(w,{value:l.connected?"online":"offline"})}),e.jsx("td",{children:l.agent_id||"-"}),e.jsx("td",{children:e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"ghost",onClick:()=>void m(l.id),children:"Pair"}),e.jsx("button",{className:"ghost",onClick:()=>void N(l.id),children:"Rotate"}),e.jsx("button",{className:"ghost danger",onClick:()=>void k(l.id),children:"Delete"})]})})]},l.id))})]}):null]})]})}function X({api:n,me:t}){const y=t.user.role==="super_admin",[h,_]=s.useState([]),[i,f]=s.useState(""),[x,j]=s.useState({scheme:"http",host:"127.0.0.1",default_port:3e3,variables:{}}),[u,g]=s.useState("{}"),[d,S]=s.useState(!0),[c,r]=s.useState(""),[o,b]=s.useState(""),m=s.useCallback(async()=>{S(!0),r("");try{const l=(await n("/api/tenants")).tenants??[];_(l),l.length===0?f(""):f(y?p=>p||l[0].id:t.user.tenant_id||l[0].id)}catch(a){r(v(a))}finally{S(!1)}},[n,y,t.user.tenant_id]);s.useEffect(()=>{m()},[m]);const N=s.useCallback(async()=>{if(i){r(""),b("");try{const l=(await n(`/api/tenants/${encodeURIComponent(i)}/environment`)).environment;j(l),g(JSON.stringify(l.variables??{},null,2))}catch(a){const l=v(a);r(l)}}},[n,i]);s.useEffect(()=>{N()},[N]);const k=s.useCallback(async a=>{if(a.preventDefault(),!i)return;b(""),r("");let l;try{const p=JSON.parse(u);if(!$(p))throw new Error("Variables must be a JSON object.");l={};for(const[P,T]of Object.entries(p))l[String(P)]=String(T)}catch(p){r(v(p));return}try{await n(`/api/tenants/${encodeURIComponent(i)}/environment`,{method:"PUT",body:JSON.stringify({scheme:x.scheme,host:x.host,default_port:x.default_port,variables:l})}),b("Environment saved.")}catch(p){r(v(p))}},[n,x,i,u]);return e.jsxs(C,{title:"Tenant Environment",actions:e.jsx("button",{onClick:()=>void N(),children:"Refresh"}),children:[d?e.jsx("p",{children:"Loading..."}):null,c?e.jsx("p",{className:"status error",children:c}):null,!d&&i?e.jsxs("form",{className:"grid cols-2",onSubmit:k,children:[y?e.jsxs("label",{children:["Tenant",e.jsx("select",{value:i,onChange:a=>f(a.target.value),children:h.map(a=>e.jsx("option",{value:a.id,children:a.id},a.id))})]}):null,e.jsxs("label",{children:["Scheme",e.jsx("input",{value:x.scheme,onChange:a=>j(l=>({...l,scheme:a.target.value}))})]}),e.jsxs("label",{children:["Host",e.jsx("input",{value:x.host,onChange:a=>j(l=>({...l,host:a.target.value}))})]}),e.jsxs("label",{children:["Default Port",e.jsx("input",{type:"number",value:x.default_port,onChange:a=>j(l=>({...l,default_port:Number(a.target.value||0)}))})]}),e.jsxs("label",{className:"wide",children:["Variables (JSON)",e.jsx("textarea",{rows:8,value:u,onChange:a=>g(a.target.value)})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",children:"Save"})})]}):null,o?e.jsx("p",{className:"status",children:o}):null]})}function Z({me:n,api:t,onLogout:y}){const h=n.user.role==="super_admin",_=h?q:M,[i,f]=s.useState(h?"adminOverview":"dashboard");s.useEffect(()=>{new Set(_.map(g=>g.key)).has(i)||f(_[0].key)},[_,i]);const x=s.useMemo(()=>i==="dashboard"?e.jsx(J,{api:t}):i==="routes"?e.jsx(Q,{api:t,me:n}):i==="connectors"?e.jsx(W,{api:t,me:n}):i==="tenantConfig"?e.jsx(X,{api:t,me:n}):i==="adminOverview"?e.jsx(V,{api:t}):i==="adminUsers"?e.jsx(G,{api:t}):i==="adminTenants"?e.jsx(B,{api:t}):i==="adminPlans"?e.jsx(H,{api:t}):i==="adminTLS"?e.jsx(z,{api:t}):i==="adminSystem"?e.jsx(K,{api:t}):e.jsx(C,{title:"Not Found",children:"Page not found."}),[t,n,i]),j=A[i];return e.jsxs("main",{className:"workspace-shell",children:[e.jsxs("aside",{className:"sidebar",children:[e.jsxs("div",{className:"brand",children:[e.jsx("h1",{children:"Proxer"}),e.jsxs("p",{children:[n.user.username," Â· ",n.user.role]})]}),e.jsx("nav",{className:"nav",children:_.map(u=>e.jsx("button",{className:u.key===i?"active":"",onClick:()=>f(u.key),children:u.label},u.key))}),e.jsx("button",{className:"ghost danger",onClick:()=>void y(),children:"Logout"})]}),e.jsxs("section",{className:"workspace-content",children:[e.jsxs("header",{className:"topbar",children:[e.jsx("h2",{children:j.title}),e.jsx("p",{children:j.subtitle})]}),e.jsx("div",{className:"page-content",children:x})]})]})}export{Z as default};
